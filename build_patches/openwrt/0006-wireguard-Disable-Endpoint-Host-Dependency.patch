From cb63c610f446926cc90ed47955c7ce03f98fb539 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fabian=20Bl=C3=A4se?= <fabian@blaese.de>
Date: Sat, 29 Dec 2018 17:46:45 +0100
Subject: [PATCH] wireguard: Disable Endpoint Host Dependency
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

When using IPv6 addresses (or DNS which has AAAA record) as endpoint,
add_host_dependency fails for some reason which causes the wireguard
interface to disappear.

Because it is not necessary for us anyway, host_dependency is disabled
for wireguard with this patch.

Signed-off-by: Fabian Bl√§se <fabian@blaese.de>
---
 package/network/services/wireguard/files/wireguard.sh | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/package/network/services/wireguard/files/wireguard.sh b/package/network/services/wireguard/files/wireguard.sh
index 96fa7215ff..559b0f9843 100644
--- a/package/network/services/wireguard/files/wireguard.sh
+++ b/package/network/services/wireguard/files/wireguard.sh
@@ -176,12 +176,12 @@ proto_wireguard_setup() {
   done
 
   # endpoint dependency
-  wg show "${config}" endpoints | \
-    sed -E 's/\[?([0-9.:a-f]+)\]?:([0-9]+)/\1 \2/' | \
-    while IFS=$'\t ' read -r key address port; do
-    [ -n "${port}" ] || continue
-    proto_add_host_dependency "${config}" "${address}"
-  done
+  #wg show "${config}" endpoints | \
+  #  sed -E 's/\[?([0-9.:a-f]+)\]?:([0-9]+)/\1 \2/' | \
+  #  while IFS=$'\t ' read -r key address port; do
+  #  [ -n "${port}" ] || continue
+  #  proto_add_host_dependency "${config}" "${address}"
+  #done
 
   proto_send_update "${config}"
 }
-- 
2.11.0

